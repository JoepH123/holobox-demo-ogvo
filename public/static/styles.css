:root {
    --user-message-bg-color: #cdcdcd;
    --assistant-message-bg-color: #ffffff;
    --assistant-message-text-color: #333333;
    --user-message-text-color: #333333;
    --message-copy-icon-color: #696969;
}

/* 1. GLOBAL RESET */
body, html {
    margin: 0;
    padding: 0;
    width: 100%;
    height: 100%;
    overflow: hidden;
    background: #ffffff; /* outside the frame */
    font-family: sans-serif;
}

/* --- NEW MAIN LAYOUT --- */
.layout-wrapper {
    display: grid;
    /* 1fr = Free space left
    auto = Width of the central frame
    1fr = Free space right (balances the left to keep center centered)
    */
    grid-template-columns: 1fr auto 1fr; 
    
    /* Adds the space between the left panel and the center frame */
    gap: 20px; 
    
    width: 100vw;
    height: 100vh;
    overflow: hidden; /* Prevents scrollbars */
}


/* -----------------------------------------------------------
    2. HIDDEN LAYER --> The right panel is invisible
    Container for elements functionality requires, but we don't want to see.
    Using visibility: hidden instead of display: none ensures they 
    still technically "take up space" in the DOM tree if the JS checks dimensions,
    but absolute positioning throws them off screen.
----------------------------------------------------------- */
.hidden-layer {
    position: absolute;
    top: -9999px;
    left: -9999px;
    width: 1px;
    height: 1px;
    overflow: hidden;
    visibility: hidden; 
    /* This is invisible, just here to take up the right side space */
    pointer-events: none;
}

/* -----------------------------------------------------------
    3. HELPER BACKUP LAYER --> the left panel can be toggled to be visible
    This layer can be toggled to be visible but is outside
    the main visual frame.
----------------------------------------------------------- */
/* --- 1. TOGGLE BUTTON STYLING --- */
.top-left-btn {
    position: absolute; /* Keeps it stuck to the screen corner */
    top: 20px;
    left: 20px;
    z-index: 1; /* Ensures it's above absolutely everything */
    
    display: flex;
    align-items: center;
    justify-content: center;
    width: 50px;
    height: 50px;
    
    background: rgba(20, 20, 20, 0.85);
    color: white; /* Icon color */
    /* border: 1px solid #e0e0e0; */
    border: none;
    border-radius: 50%; /* Makes it round */
    box-shadow: 0 6px 30px rgba(0,0,0,0.6);
    cursor: pointer;
    transition: all 0.3s ease;

    /* To fully hide the chat and the button only set this to hidden, if you want to see it set it to visible */
    visibility: hidden;  /* hidden | visible */
}

/* Button hover effect */
.top-left-btn:hover { transform: translateY(-5px); background: rgba(20, 20, 20, 0.65); transition: transform .4s ease;}

/* Sizing the SVG inside the button */
.top-left-btn svg {
    width: 24px;
    height: 24px;
}

/* Optional: Style for when the chat is currently OFF (e.g., make button grey) */
.top-left-btn.chat-off {
    background: rgb(121, 6, 4);
    color: white;
}

.top-left-btn.chat-off:hover { transform: translateY(-5px); background: rgba(121, 6, 4, 0.65); transition: transform .4s ease;}

.visible-outside-frame {
    /* This ensures content inside aligns to the right, 
    closest to the main frame (optional style choice) */
    position: relative;
    display: flex;
    justify-content: flex-end; 
    align-items: center;
    overflow: hidden;

    /* For toggling visibility */
    /* transition and opacity for smooth toggling */
    opacity: 1;
    visibility: visible;  /* hidden | visible */
    transition: opacity 0.3s ease, visibility 0.3s ease;

    /* 
       To fully turn off everything outside avatar area:
       You only need to set the visibility of the chat button to hidden
    */

    /* Visuals for testing */
    /* background: rgba(0, 0, 0, 0.05); */
}

/* Hidden chat styling: Javascript will add this class to the frame to hide it. */
.visible-outside-frame.is-hidden {
    /* This is the core request: make it invisible and untouchable */
    visibility: hidden;
    pointer-events: none;
    
    /* Makes it fade out nicely */
    opacity: 0; 
}

/* --- CHAT AREA (BACKUP) --- */
.backup-chat-area {
    position: absolute;
    top: 25%;
    bottom: 25%;
    left: 0;
    width: 100%;
    z-index: 1; /* Very High Z-Index */
    display: flex;
    justify-content: center;
    opacity: 1;
}

.chat-messages {
    width: 100%;
    z-index: 2;
    overflow-y: auto
}

/* Messages scroll area */
#messages {
    flex: 1;
    overflow-y: auto;
    padding-right: 0.5rem;
}

/* Message bubble (base) */
.message {
    position: relative;
    width: fit-content;
    max-width: 70%;
    margin: 1.5rem 0;
    padding: 1rem;
    line-height: 1.4;
    white-space: pre-wrap;
    overflow-wrap: break-word;
    background: var(--assistant-message-bg-color);
    border: 1px solid rgb(39, 39, 39, 0.5);
    border-radius: 0.75rem;
}

/* User message (right-aligned, distinct bg) */
.message.user {
    margin-left: auto;
    margin-right: 5%;
    background: var(--user-message-bg-color);
    color: var(--user-message-text-color);
}

/* Assistant message (full-width card) */
.message.assistant,
.message.assistant.loading {
    width: 90%;
    max-width: 90%;
    margin: 0.5rem auto;     /* center horizontally */
    text-align: left;
    background: var(--assistant-message-bg-color);
    color: var(--assistant-message-text-color)
}

/* Inline loading spinner for assistant bubble */
.message.assistant.loading::after {
    content: "";
    position: absolute;
    bottom: 0.5rem;
    right: 0.75rem;
    width: 1rem;
    height: 1rem;
    border: 2px solid transparent;
    border-top-color: var(--primary-client-color);
    border-right-color: var(--primary-client-color);
    border-bottom-color: var(--primary-client-color);
    border-radius: 50%;
    animation: spin 1s linear infinite;
}

#messages:empty::before {
    content: var(--welcome-text);
    display: block;
    text-align: center;
    color: var(--welcome-text-color);
    font-size: 1.15rem;
    margin-top: 2rem;
    padding: 0 1rem;
    white-space: pre-wrap;
}

/* Copy-to-clipboard icon button on messages */
.copy-btn {
    position: absolute;
    bottom: 0.5rem;
    right: 0.5rem;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    width: 2rem;
    height: 2rem;
    padding: 0.25rem;
    border: none;
    background: none;
    cursor: pointer;
    transition: opacity 0.2s ease;
    color: var(--assistant-message-bg-color);
}
.copy-btn svg path { width: 1.5rem; height: 1.5rem; fill: var(--assistant-message-bg-color); stroke: var(--message-copy-icon-color); }
.copy-btn:hover svg path { stroke: var(--primary-client-color); }
.copy-btn:focus-visible {
    outline: 2px solid var(--primary-client-color);
    outline-offset: 2px;
}

/* --- INPUT CONSOLE (BOTTOM CENTER) --- */
/* We use the ORIGINAL class name '.input-area' but override its style locally */
.input-overlay-wrapper {
    position: absolute;
    left: 0;
    width: 100%;
    bottom: 0%;
    z-index: 3; /* Very High Z-Index */
    display: flex;
    justify-content: center;
    pointer-events: none; /* Allow clicks to pass through around the box */
    opacity: 1;
    /* visibility: hidden; */
}

/* This mimics the original structure expected by JS */
.composer {
    pointer-events: auto; /* Re-enable clicks specifically for the box */
    background: rgba(20, 20, 20, 0.85);
    backdrop-filter: blur(12px);
    border: 1px solid rgba(255, 255, 255, 0.15);
    border-radius: 40px;
    width: 90%;
    max-width: 650px;
    padding: 10px 15px;
    display: flex;
    align-items: center;
    gap: 10px;
    box-shadow: 0 5px 15px rgba(0,0,0,0.6);
}

#userInput {
    background: transparent;
    border: none;
    color: #fff;
    flex-grow: 1;
    font-size: 1.05rem;
    outline: none;
    resize: none;
    max-height: 120px;
    padding: 8px 5px;
    font-family: inherit;
}
#userInput::placeholder { color: rgba(255,255,255,0.5); }

/* Send button styles */
#sendBtn {
    background: transparent;
    border: none;
    cursor: pointer;
    color: white;
    width: 42px;
    height: 42px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
}
#sendBtn:hover { background: rgba(255,255,255,0.1); }
svg { fill: currentColor; stroke: currentColor; }

/* -----------------------------------------------------------
    4. VISUAL LAYER
    This is the main stage.
----------------------------------------------------------- */

.visible-frame {
    /* Set the frame in which everything for the holobox is presented */
    position: relative;  /* Makes this visible frame the positional context for components in it */
    aspect-ratio: 9 / 16;
    height: 100vh;
    width: calc(100vh * 9 / 16);
    max-width: 100vw;
    max-height: 100vh;
    /* padding: 5%;  */

    background: #ffffff;
    overflow: hidden;           /* keeps content inside the frame */
    /* Ensure it doesn't get crushed */
    flex-shrink: 0; 

    /* border: 1px solid lightgrey;    */
    /* â† frame border for testing */
}

.overlay-unconnected {
    position: absolute;
    width: 100%;
    height: 100%;
    background: rgb(39, 39, 39, 0.75);
    z-index: 4;

    /* For toggling visibility */
    /* transition and opacity for smooth toggling */
    opacity: 1;
    /* visibility: visible; */
    visibility: hidden;
    transition: opacity 0.3s ease, visibility 0.3s ease;
}

.text-unconnected {
    position: absolute;
    top: 25%;
    width: 100%;       /* Span the full width */
    text-align: center; /* Center the words inside that full width */
    font-family: 'Rajdhani', sans-serif;
    text-transform: uppercase; /* Often looks better uppercase for sci-fi */
    color: white;
    font-weight: bold;
    margin: 0;         /* Good practice to remove default browser margins */
}

.overlay-unconnected.is-hidden {
    /* This is the core request: make it invisible and untouchable */
    visibility: hidden;
    pointer-events: none;
    
    /* Makes it fade out nicely */
    opacity: 0; 
}

/* --- AVATAR --- */
.avatar-container {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    z-index: 1;  /* Lowest layer -> overlay buttons */
    display: flex;
    justify-content: center;
    align-items: center;
}

/* Style settings fallback image and actual avatar stream */
#avatarMedia, #avatarVideo {
    height: 100%;
    width: auto;
    object-fit: contain;
    display: block;
}

/* --- AVATAR CONTROLS (TOP LEFT) --- */

/* --- Avatar control panel --- */

.avatar-controls {
    position: absolute;
    top: 2%; 
    left: calc(2% / (9/16)); /* correcly align in top left 2 percent from top and from left */
    width: 20%;
    height: 5%;
    z-index: 5; 
    display: flex;
    gap: 5%;
    background: white;
    border-radius: 12% / calc(12% / (9/16)); /* match avatar card rounding */
    padding: 1.5%;
    box-shadow: 0 0.6vmin 1.4vmin rgba(0, 0, 0, 0.15);
    opacity: 1;
    justify-content: space-between;
    transition: opacity .4s ease, transform .4s ease;
}

/* Hidden state while streaming (JS toggles this class) */
.avatar-controls.auto-hidden {
    opacity: 0;
    transform: translateY(6px);
    pointer-events: none;
}

/* When NOT live/streaming, controls should be visible regardless */
.avatar-card:not(.live) .avatar-controls {
    opacity: 1 !important;
    transform: translateY(0) !important;
    pointer-events: auto !important;
}

/* --- Avatar control button styling details --- */

.avatarBtn {
  border: none;
  cursor: pointer;

  display: flex;
  align-items: center;
  justify-content: center;

  /* Button size linked to panel height */
  height: 100%;              /* fill the panelâ€™s inner height */
  aspect-ratio: 1 / 1;       /* always a circle */
  width: auto;               /* derived from aspect-ratio */

  border-radius: 50%;
  padding: 0;
  line-height: 0;

  color: white;
  background-color: rgb(40, 167, 69);

  transition: background-color .3s ease, transform .2s ease;
}

#btnInterrupt {
    background-color: #dcdcdc;    
    color: rgb(39, 39, 39);  
    position: relative;   
    opacity:.85;    
}

/* Size & block layout for the SVG */
#btnInterrupt svg {
    display: block;             /* no baseline gap */
    width: 35%;       /* adjust size of connection symbol */
    height: 35%;
}

/* Greyed-out look when disabled */
#btnInterrupt:disabled {
    background-color: #dcdcdc;       
    color: rgb(39, 39, 39);                   
    cursor: default;             
    transform: none;                
    box-shadow: none;                
    opacity: 0.4;                    
}

/* Loading pulse + spinner for Interrupt (mirrors Start/Stop loading) */ 
#btnInterrupt.loading {
    pointer-events: none;
    animation: btn-pulse 0.9s ease-in-out infinite;
    box-shadow: 0 0 0 0 rgba(0,0,0,0.12);
}
#btnInterrupt.loading::after { 
    content: "";
    position: absolute;
    width: 110%;
    height: 110%;
    border-radius: 50%;
    border-top-color: transparent;
    animation: btn-spin 0.75s linear infinite;
}

#btnStartStop svg {
    width: 65%;       /* adjust size of connection symbol */
    height: 65%;
    /* Color is changed using the "color" argument in the AvatarButton*/
}

#btnStartStop:hover, #btnInterrupt:not(:disabled):hover { transform: scale(1.05); filter: opacity(0.80); } 

#btnStartStop[data-state="stop"] {
    background-color: rgb(220, 53, 69);  /* ðŸ”´ stop */
}

/* Loading pulse (applies while async start/stop is running) */
#btnStartStop.loading {
    pointer-events: none;            /* ignore extra clicks during async work */
    animation: btn-pulse 0.9s ease-in-out infinite;
    box-shadow: 0 0 0 0 rgba(0,0,0,0.12);
}

/* Larger spinner outside the button area */
#btnStartStop.loading::after { 
    content: "";
    position: absolute;
    width: 110%;
    height: 110%;
    border-radius: 50%;
    border: 2px solid rgba(40, 167, 69, 0.5); /* ðŸŸ¢ green */
    border-top-color: transparent;
    animation: btn-spin 0.75s linear infinite;
}

/* When data-state="stop", make the spinner red */
#btnStartStop[data-state="stop"].loading::after {
    border: 2px solid rgba(220, 53, 69, 0.5); /* ðŸ”´ red */
}

/* Make sure the button can host the ::after spinner */
#btnStartStop { position: relative; }

@keyframes btn-pulse {
    0%   { transform: scale(1.00); }
    50%  { transform: scale(1.06); }
    100% { transform: scale(1.00); }
}
@keyframes btn-spin {
    to { transform: rotate(360deg); }
}

/* MICROPHONE STYLING */

/* Mic component div */

.mic-button-component {
    position: absolute;
    top: 40%;
    left: 85%;
    width: 10%;  /* clamp(48px, 12%, 96px); */
    aspect-ratio: 1 / 1;  /* ðŸ‘ˆ keeps width = height */
    z-index: 5;
}

/* Mic button styles */
#micBtn {
    background: rgba(20, 20, 20, 0.85);
    /* border: none; */
    border: 1px solid rgba(255, 255, 255, 0.15);
    cursor: pointer;
    color: white;
    width: 100%;
    height: 100%;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    box-shadow: 0 1.2vmin 3vmin rgba(0, 0, 0, 0.4);

}
#micBtn:active { background: rgba(20, 20, 20, 0.65); transition: transform .4s ease;}
#micBtn:hover { transform: scale(1.05); filter: opacity(0.80); transition: background-color .3s ease, transform .2s ease; }

/* Recording (active dictation) state */
#micBtn.recording {
background-color: rgb(121, 6, 4);      /* bright red when recording */
color: white;
animation: pulse 1.2s ease-in-out infinite;
transform: scale(0.9);
}

/* By default, hide the special state icons; show MIC icon */
.icon-text, 
.icon-speaking {
    display: none;
}
.icon-default {
    width: 60%; height: 60%; display: block;
}

/* We want to pulse not to change the button but a slighly lighter colored aarea behind the button with same size as the button */
#micBtn::before {
  content: "";
  position: absolute;
  inset: 0;                 /* same size as button */
  border-radius: 50%;
  background: rgba(154, 30, 28, 0.35);
  z-index: -1;              /* behind the button */
  transform: scale(1);
  opacity: 0;
  pointer-events: none;
}

#micBtn.recording::before {
  animation: mic-pulse 1.4s ease-out infinite;
}

/* Subtle pulsing animation to indicate active listening */
@keyframes mic-pulse {
  0% {
    transform: scale(1);
    opacity: 0.9;
  }
  70% {
    transform: scale(1.35);
    opacity: 0.5;
  }
  100% {
    transform: scale(1);
    opacity: 0;
  }
}

/* MIC Button Animations While Waiting For Response */

/* LOADING TEXT RESPONSE */

/* Recording (active dictation) state */
#micBtn.loading-text {
    background-color: rgba(121, 6, 4, 0.75);      /* bright red when recording */
    color: white;
    pointer-events: none;            /* ignore extra clicks during async work */
    /* animation: mic-btn-pulse 0.9s ease-in-out infinite; */
    box-shadow: 0 0 0 0 rgba(0,0,0,0.12);
}

/* When button has class 'is-loading' */
#micBtn.loading-text .icon-default { display: none; }
#micBtn.loading-text .icon-speaking { display: none; }
#micBtn.loading-text .icon-text { width: 60%; height: 60%; display: block; }

/* Larger spinner outside the button area */
#micBtn.loading-text::after { 
    content: "";
    position: absolute;
    width: 110%;
    height: 110%;
    border-radius: 50%;
    border: 2px solid rgba(121, 6, 4, 0.8); /* Red */
    border-top-color: transparent;
    animation: mic-btn-spin 0.75s linear infinite;
}

/* LOADING VERBAL (SPEECH RESPONSE) */

/* Recording (active dictation) state */
#micBtn.loading-speech {
    background-color: rgba(121, 6, 4, 0.75);      /* bright red when recording */
    color: white;
    pointer-events: none;            /* ignore extra clicks during async work */
    box-shadow: 0 0 0 0 rgba(0,0,0,0.12);
}

#micBtn.loading-speech .icon-default { display: none; }
#micBtn.loading-speech .icon-speaking { width: 60%; height: 60%; display: block; }
#micBtn.loading-speech .icon-text { display: none; }

/* Larger spinner outside the button area */
#micBtn.loading-speech::after { 
    content: "";
    position: absolute;
    width: 110%;
    height: 110%;
    border-radius: 50%;
    border: 2px solid rgba(121, 6, 4, 0.8); /* Red */
    border-top-color: transparent;
    animation: mic-btn-spin 0.75s linear infinite;
}

@keyframes mic-btn-spin {
    to { transform: rotate(360deg); }
}